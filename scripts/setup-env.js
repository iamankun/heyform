// Generated by An Kun

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

async function setupEnvironment() {
  console.log('üîß Setting up environment variables...');
  
  try {
    // Check if Vercel CLI is installed
    try {
      execSync('vercel --version', { stdio: 'pipe' });
    } catch (error) {
      console.log('üì¶ Installing Vercel CLI...');
      execSync('npm install -g vercel', { stdio: 'inherit' });
    }

    // Pull environment variables from Vercel
    console.log('‚¨áÔ∏è Pulling environment variables from Vercel...');
    execSync('vercel env pull .env.development.local', { stdio: 'inherit' });

    // Verify the file was created
    if (fs.existsSync('.env.development.local')) {
      console.log('‚úÖ Environment variables pulled successfully!');
      
      // Read and validate environment variables
      const env_content = fs.readFileSync('.env.development.local', 'utf8');
      const required_vars = [
        'DATABASE_URL',
        'NEXT_PUBLIC_STACK_PROJECT_ID',
        'STACK_SECRET_SERVER_KEY'
      ];
      
      const missing_vars = required_vars.filter(var_name => 
        !env_content.includes(`${var_name}=`)
      );
      
      if (missing_vars.length > 0) {
        console.log('‚ö†Ô∏è Missing required environment variables:');
        missing_vars.forEach(var_name => console.log(`  - ${var_name}`));
        console.log('\nüîó Please add these variables in your Vercel dashboard:');
        console.log('   https://vercel.com/dashboard/projects/your-project/settings/environment-variables');
      } else {
        console.log('‚úÖ All required environment variables are present!');
      }
    } else {
      console.error('‚ùå Failed to create .env.development.local file');
    }

  } catch (error) {
    console.error('‚ùå Error setting up environment:', error.message);
    console.log('\nüí° Manual setup instructions:');
    console.log('1. Install Vercel CLI: npm install -g vercel');
    console.log('2. Login to Vercel: vercel login');
    console.log('3. Link project: vercel link');
    console.log('4. Pull env vars: vercel env pull .env.development.local');
  }
}

setupEnvironment();
